<div class="modern-form-container">
  <div class="modern-form-wrapper">
    <div class="modern-form-header">
      <h2 class="modern-form-title">
        <fa-icon [icon]="['fas', 'exclamation-triangle']" class="me-2"></fa-icon>
        <span appTranslate="longonkeloApp.ocorrencia.home.createOrEditLabel"> Criar ou editar Ocorrencia </span>
      </h2>
    </div>

    <form name="editForm" role="form" novalidate (ngSubmit)="save()" [formGroup]="editForm" class="modern-form">
      <app-alert-error></app-alert-error>

      <!-- Hidden ID field -->
      <input type="hidden" name="id" formControlName="id" *ngIf="editForm.controls.id.value !== null" />

      <!-- Seção 1: Descrição da Ocorrência -->
      <fieldset class="modern-form-section">
        <legend class="modern-form-section-title">
          <fa-icon [icon]="['fas', 'file-alt']" class="section-icon me-2"></fa-icon>
          <span>Descrição da Ocorrência</span>
        </legend>

        <div class="row">
          <div class="col-12 mb-3">
            <label class="form-label" for="field_descricao">
              <fa-icon [icon]="['fas', 'align-left']" class="me-1"></fa-icon>
              <span appTranslate="longonkeloApp.ocorrencia.descricao">Descrição</span>
              <span class="text-danger">*</span>
            </label>
            <textarea
              class="form-control"
              name="descricao"
              id="field_descricao"
              data-cy="descricao"
              formControlName="descricao"
              rows="4"
              placeholder="Descreva detalhadamente a ocorrência..."
              [class.is-invalid]="
                editForm.get('descricao')!.invalid && (editForm.get('descricao')!.dirty || editForm.get('descricao')!.touched)
              "
            ></textarea>
            <div *ngIf="editForm.get('descricao')!.invalid && (editForm.get('descricao')!.dirty || editForm.get('descricao')!.touched)">
              <small
                class="form-text text-danger"
                *ngIf="editForm.get('descricao')?.errors?.required"
                appTranslate="entity.validation.required"
              >
                O campo é obrigatório.
              </small>
            </div>
            <small class="form-text text-muted"> Forneça uma descrição clara e detalhada da ocorrência </small>
          </div>
        </div>
      </fieldset>

      <!-- Seção 2: Pessoas Envolvidas -->
      <fieldset class="modern-form-section">
        <legend class="modern-form-section-title">
          <fa-icon [icon]="['fas', 'users']" class="section-icon me-2"></fa-icon>
          <span>Pessoas Envolvidas</span>
        </legend>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label" for="field_docente">
              <fa-icon [icon]="['fas', 'chalkboard-teacher']" class="me-1"></fa-icon>
              <span appTranslate="longonkeloApp.ocorrencia.docente">Docente Responsável</span>
              <span class="text-danger">*</span>
            </label>
            <select
              class="form-control"
              id="field_docente"
              data-cy="docente"
              name="docente"
              formControlName="docente"
              [compareWith]="compareDocente"
              [class.is-invalid]="
                editForm.get(['docente'])!.invalid && (editForm.get(['docente'])!.dirty || editForm.get(['docente'])!.touched)
              "
            >
              <option *ngIf="editForm.get(['docente'])!.value == null" [ngValue]="null" selected>Selecione um docente</option>
              <option [ngValue]="docenteOption" *ngFor="let docenteOption of docentesSharedCollection">
                {{ docenteOption.nome }}
              </option>
            </select>
            <div *ngIf="editForm.get(['docente'])!.invalid && (editForm.get(['docente'])!.dirty || editForm.get(['docente'])!.touched)">
              <small
                class="form-text text-danger"
                *ngIf="editForm.get(['docente'])?.errors?.required"
                appTranslate="entity.validation.required"
              >
                O campo é obrigatório.
              </small>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label" for="field_matricula">
              <fa-icon [icon]="['fas', 'user-graduate']" class="me-1"></fa-icon>
              <span appTranslate="longonkeloApp.ocorrencia.matricula">Estudante Envolvido</span>
              <span class="text-danger">*</span>
            </label>
            <select
              class="form-control"
              id="field_matricula"
              data-cy="matricula"
              name="matricula"
              formControlName="matricula"
              [compareWith]="compareMatricula"
              [class.is-invalid]="
                editForm.get(['matricula'])!.invalid && (editForm.get(['matricula'])!.dirty || editForm.get(['matricula'])!.touched)
              "
            >
              <option *ngIf="editForm.get(['matricula'])!.value == null" [ngValue]="null" selected>Selecione um estudante</option>
              <option [ngValue]="matriculaOption" *ngFor="let matriculaOption of matriculasSharedCollection">
                {{ matriculaOption.numeroMatricula }}
              </option>
            </select>
            <div
              *ngIf="editForm.get(['matricula'])!.invalid && (editForm.get(['matricula'])!.dirty || editForm.get(['matricula'])!.touched)"
            >
              <small
                class="form-text text-danger"
                *ngIf="editForm.get(['matricula'])?.errors?.required"
                appTranslate="entity.validation.required"
              >
                O campo é obrigatório.
              </small>
            </div>
          </div>
        </div>
      </fieldset>

      <!-- Seção 3: Contexto e Classificação -->
      <fieldset class="modern-form-section">
        <legend class="modern-form-section-title">
          <fa-icon [icon]="['fas', 'tags']" class="section-icon me-2"></fa-icon>
          <span>Contexto e Classificação</span>
        </legend>

        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label" for="field_estado">
              <fa-icon [icon]="['fas', 'flag']" class="me-1"></fa-icon>
              <span appTranslate="longonkeloApp.ocorrencia.estado">Categoria da Ocorrência</span>
              <span class="text-danger">*</span>
            </label>
            <select
              class="form-control"
              id="field_estado"
              data-cy="estado"
              name="estado"
              formControlName="estado"
              [compareWith]="compareCategoriaOcorrencia"
              [class.is-invalid]="
                editForm.get(['estado'])!.invalid && (editForm.get(['estado'])!.dirty || editForm.get(['estado'])!.touched)
              "
            >
              <option *ngIf="editForm.get(['estado'])!.value == null" [ngValue]="null" selected>Selecione uma categoria</option>
              <option [ngValue]="categoriaOcorrenciaOption" *ngFor="let categoriaOcorrenciaOption of categoriaOcorrenciasSharedCollection">
                {{ categoriaOcorrenciaOption.descricao }}
              </option>
            </select>
            <div *ngIf="editForm.get(['estado'])!.invalid && (editForm.get(['estado'])!.dirty || editForm.get(['estado'])!.touched)">
              <small
                class="form-text text-danger"
                *ngIf="editForm.get(['estado'])?.errors?.required"
                appTranslate="entity.validation.required"
              >
                O campo é obrigatório.
              </small>
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label" for="field_licao">
              <fa-icon [icon]="['fas', 'book-open']" class="me-1"></fa-icon>
              <span appTranslate="longonkeloApp.ocorrencia.licao">Lição Relacionada</span>
              <span class="text-danger">*</span>
            </label>
            <select
              class="form-control"
              id="field_licao"
              data-cy="licao"
              name="licao"
              formControlName="licao"
              [compareWith]="compareLicao"
              [class.is-invalid]="editForm.get(['licao'])!.invalid && (editForm.get(['licao'])!.dirty || editForm.get(['licao'])!.touched)"
            >
              <option *ngIf="editForm.get(['licao'])!.value == null" [ngValue]="null" selected>Selecione uma lição</option>
              <option [ngValue]="licaoOption" *ngFor="let licaoOption of licaosSharedCollection">Lição {{ licaoOption.numero }}</option>
            </select>
            <div *ngIf="editForm.get(['licao'])!.invalid && (editForm.get(['licao'])!.dirty || editForm.get(['licao'])!.touched)">
              <small
                class="form-text text-danger"
                *ngIf="editForm.get(['licao'])?.errors?.required"
                appTranslate="entity.validation.required"
              >
                O campo é obrigatório.
              </small>
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <div class="severity-indicator">
              <label class="form-label">
                <fa-icon [icon]="['fas', 'thermometer-half']" class="me-1"></fa-icon>
                Nível de Gravidade
              </label>
              <div class="severity-levels">
                <div class="severity-level low">
                  <div class="severity-dot"></div>
                  <span>Baixo</span>
                </div>
                <div class="severity-level medium">
                  <div class="severity-dot"></div>
                  <span>Médio</span>
                </div>
                <div class="severity-level high">
                  <div class="severity-dot"></div>
                  <span>Alto</span>
                </div>
              </div>
              <small class="form-text text-muted"> Classificação visual baseada na categoria selecionada </small>
            </div>
          </div>
        </div>
      </fieldset>

      <!-- Botões de Ação -->
      <div class="modern-form-actions">
        <button type="button" id="cancel-save" data-cy="entityCreateCancelButton" class="btn btn-secondary me-2" (click)="previousState()">
          <fa-icon icon="ban"></fa-icon>&nbsp;<span appTranslate="entity.action.cancel">Cancelar</span>
        </button>

        <button
          type="submit"
          id="save-entity"
          data-cy="entityCreateSaveButton"
          [disabled]="editForm.invalid || isSaving"
          class="btn btn-primary"
        >
          <fa-icon icon="save"></fa-icon>&nbsp;<span appTranslate="entity.action.save">Guardar</span>
        </button>
      </div>
    </form>
  </div>
</div>
